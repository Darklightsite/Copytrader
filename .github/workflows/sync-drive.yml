# A munkafolyamat neve, ami megjelenik az Actions fülön
name: Sync Google Drive Folder to GitHub

# A futtatás feltételei
on:
  # Időzített futtatás: 5 percenként
  schedule:
    - cron: '*/5 * * * *'
  
  # Kézi indítás engedélyezése az Actions fülről
  workflow_dispatch:

# A feladatok, amiket a workflow végrehajt
jobs:
  sync:
    # A futtató környezet operációs rendszere
    runs-on: ubuntu-latest
    
    # A lépések, amikből a feladat áll
    steps:
      # 1. lépés: A repository tartalmának letöltése
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. lépés: Hitelesítés a Google Cloud felé a hivatalos action segítségével
      - name: Authenticate to Google Cloud
        uses: 'google-github-actions/auth@v2'
        with:
          credentials_json: '${{ secrets.GDRIVE }}'

      # 3. lépés: A gdown letöltő eszköz telepítése
      - name: Install gdown
        run: pip install gdown

      # 4. lépés: A mappa letöltése a gdown eszközzel
      # FONTOS: Itt a saját mappa ID-dnak kell szerepelnie!
      - name: Download folder with gdown
        run: gdown --folder '1SweHd5mgCX7eTr9EmtRHb6jjkcnMyaNf' -O . --quiet
      - name: List downloaded files for debugging
        run: ls -R
      # 5. lépés: Változások commitelése és feltöltése
      - name: Commit and push if there are changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git diff --quiet --exit-code || (git add -A && git commit -m "Automated sync from Google Drive" && git push)

